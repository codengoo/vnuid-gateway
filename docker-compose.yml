services:
  postgres:
    image: postgres
    container_name: postgres
    environment:
      POSTGRES_PASSWORD: exam1234
      POSTGRES_USER: examuser
      POSTGRES_DB: vnuid
    ports:
      - "5432:5432"
    volumes:
      - postgres_data:/var/lib/postgresql/data
    networks:
      - vnuid_network
  
  rabbitmq:
    image: rabbitmq:3-management-alpine
    container_name: rabbitmq
    ports:
      - "5672:5672"  # Cổng AMQP cho Celery
      - "15672:15672"  # Cổng Web UI quản lý RabbitMQ
    environment:
      RABBITMQ_DEFAULT_USER: user
      RABBITMQ_DEFAULT_PASS: password
    networks:
    - vnuid_network

  redis:
    image: redis:7-alpine
    container_name: redis
    ports:
    - "6379:6379"
    command: ["redis-server"]
    networks:
    - vnuid_network

  vnuid_identity: 
    image: vnuid-identity:latest
    container_name: vnuid-identity
    ports:
      - "3333:3333"
    environment:
      DATABASE_URL: postgres://examuser:exam1234@postgres:5432/vnuid?sslmode=disable
    networks:
    - vnuid_network
    depends_on:
      - postgres

  vnuid_management: 
    image: vnuid-identity:latest
    container_name: vnuid-identity
    ports:
      - "3333:3333"
    environment:
      DATABASE_URL: postgres://examuser:exam1234@postgres:5432/vnuid?sslmode=disable
    networks:
    - vnuid_network
    depends_on:
      - postgres

  vnuid_cdn: 
    image: vnuid-identity:latest
    container_name: vnuid-identity
    ports:
      - "3333:3333"
    environment:
      DATABASE_URL: postgres://examuser:exam1234@postgres:5432/vnuid?sslmode=disable
    networks:
    - vnuid_network
    depends_on:
      - postgres

  vnuid_client: 
    image: vnuid-identity:latest
    container_name: vnuid-identity
    ports:
      - "3333:3333"
    environment:
      DATABASE_URL: postgres://examuser:exam1234@postgres:5432/vnuid?sslmode=disable
    networks:
    - vnuid_network
    depends_on:
      - postgres
  
  vnuid_gateway:
    image: vnuid-gateway:latest
    container_name: vnuid-gateway
    ports:
      - "1234:80"
    networks:
    - vnuid_network
    # depends_on:
      # - postgres
      #   - vnuid_identity

volumes:
  postgres_data:
  cdn_data:

networks:
  vnuid_network:
    driver: bridge